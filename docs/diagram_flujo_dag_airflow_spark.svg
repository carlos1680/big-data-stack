<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1100" height="500" viewBox="0 0 1100 500" xmlns="http://www.w3.org/2000/svg">
  <style>
    .title { font: bold 22px sans-serif; }
    .subtitle { font: 15px sans-serif; }
    .box { fill: #f5f5f5; stroke: #424242; stroke-width: 1.5; }
    .box-actor { fill: #e3f2fd; stroke: #1565c0; stroke-width: 1.8; }
    .box-step { fill: #e8f5e9; stroke: #2e7d32; stroke-width: 1.8; }
    .box-data { fill: #fff3e0; stroke: #ef6c00; stroke-width: 1.8; }
    .label { font: 14px sans-serif; }
    .small { font: 11px sans-serif; }
    .arrow { stroke: #555555; stroke-width: 1.4; marker-end: url(#arrowhead); fill: none; }
    .dashed { stroke-dasharray: 6 4; }
  </style>

  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7"
            refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555555" />
    </marker>
  </defs>

  <!-- Títulos -->
  <text x="550" y="40" text-anchor="middle" class="title">
    Flujo típico de un DAG en BIGDATASTACK
  </text>
  <text x="550" y="65" text-anchor="middle" class="subtitle">
    Airflow → Spark → MariaDB / MinIO (+ Superset / Jupyter)
  </text>

  <!-- Actor: Usuario / Scheduler -->
  <rect x="30" y="110" width="150" height="80" rx="10" ry="10" class="box-actor" />
  <text x="105" y="140" text-anchor="middle" class="label">Airflow Scheduler</text>
  <text x="105" y="160" text-anchor="middle" class="small">Lanza DAG en horario</text>

  <!-- Task 1: Extraer desde MariaDB -->
  <rect x="260" y="100" width="220" height="90" rx="10" ry="10" class="box-step" />
  <text x="370" y="130" text-anchor="middle" class="label">Task 1: PythonOperator</text>
  <text x="370" y="150" text-anchor="middle" class="small">Lee tabla sensores / metadata</text>

  <!-- Task 2: Spark -->
  <rect x="260" y="225" width="220" height="90" rx="10" ry="10" class="box-step" />
  <text x="370" y="255" text-anchor="middle" class="label">Task 2: SparkSubmitOperator</text>
  <text x="370" y="275" text-anchor="middle" class="small">Procesa datos con Spark</text>

  <!-- Task 3: Carga resultados -->
  <rect x="260" y="350" width="220" height="90" rx="10" ry="10" class="box-step" />
  <text x="370" y="380" text-anchor="middle" class="label">Task 3: Carga resultados</text>
  <text x="370" y="400" text-anchor="middle" class="small">Escribe a tabla resumen</text>

  <!-- Data: MariaDB -->
  <rect x="550" y="130" width="190" height="80" rx="12" ry="12" class="box-data" />
  <text x="645" y="160" text-anchor="middle" class="label">MariaDB</text>
  <text x="645" y="180" text-anchor="middle" class="small">Tabla sensores / resumen</text>

  <!-- Data: MinIO -->
  <rect x="550" y="275" width="190" height="80" rx="12" ry="12" class="box-data" />
  <text x="645" y="305" text-anchor="middle" class="label">MinIO (S3)</text>
  <text x="645" y="325" text-anchor="middle" class="small">Parquet / CSV procesados</text>

  <!-- Consumo: Superset -->
  <rect x="800" y="140" width="220" height="80" rx="12" ry="12" class="box-actor" />
  <text x="910" y="170" text-anchor="middle" class="label">Superset</text>
  <text x="910" y="190" text-anchor="middle" class="small">Dashboards sobre MariaDB / MinIO</text>

  <!-- Consumo: Jupyter -->
  <rect x="800" y="285" width="220" height="80" rx="12" ry="12" class="box-actor" />
  <text x="910" y="315" text-anchor="middle" class="label">JupyterLab</text>
  <text x="910" y="335" text-anchor="middle" class="small">Análisis interactivo / notebooks</text>

  <!-- Flechas Airflow Scheduler -> Task 1 -->
  <line x1="180" y1="150" x2="260" y2="145" class="arrow" />

  <!-- Dependencias de tareas -->
  <line x1="370" y1="195" x2="370" y2="225" class="arrow" />
  <line x1="370" y1="315" x2="370" y2="350" class="arrow" />

  <!-- Task 1 <-> MariaDB -->
  <line x1="480" y1="145" x2="550" y2="170" class="arrow" />
  <line x1="550" y1="170" x2="480" y2="185" class="arrow dashed" />

  <!-- Task 2 <-> MariaDB / MinIO -->
  <line x1="480" y1="255" x2="550" y2="170" class="arrow" />
  <line x1="480" y1="285" x2="550" y2="315" class="arrow" />

  <!-- Task 3 -> MariaDB -->
  <line x1="480" y1="380" x2="550" y2="200" class="arrow" />

  <!-- Consumo desde MariaDB / MinIO -->
  <line x1="740" y1="170" x2="800" y2="180" class="arrow" />
  <line x1="740" y1="315" x2="800" y2="315" class="arrow" />

</svg>
